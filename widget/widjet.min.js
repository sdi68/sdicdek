function ipolWidjetController(e){var t={label:"iWidjet",params:{}};for(var i in void 0===e&&(e={}),t)void 0===e[i]&&(e[i]=t[i]);var o=e.label,n=e.params;this.options={get:function(e){return c.get(e)},set:function(e,t){c.set(e,t)}},this.binders={add:function(e,t){a.addBind(e,t)},trigger:function(e,t){a.trigger(e,t)}},this.states={check:function(e){l.check(e)}},this.service={cloneObj:function(e){return r.cloneObj(e)},concatObj:function(e,t){return r.concatObj(e,t)},isEmpty:function(e){return r.isEmpty(e)},inArray:function(e,t){return r.inArray(e,t)},loadTag:function(e,t,i){r.loadTag(e,t,i)}},this.logger={warn:function(e){return s.warn(e)},error:function(e){return s.error(e)},log:function(e){return s.log(e)}};var s={warn:function(e){this.check("warn")&&console.warn(o+": ",e)},error:function(e){this.check("error")&&console.error(o+": ",e)},log:function(e){if(this.check("log"))if("object"==typeof e)for(var t in console.log(o+": "),e)console.log(t,e[t]);else console.log(o+": ",e)},check:function(e){var t=!1;switch(e){case"warn":t=c.check(!0,"showWarns");break;case"error":t=c.check(!0,"showErrors");break;case"log":t=c.check(!0,"showLogs")}return t&&c.check(!1,"hideMessages")}},r={cloneObj:function(e){var t=!1;if("object"!=typeof e)return t;if(1===arguments.length)for(var i in t={},e)t[i]=e[i];else for(var i in t=[],e)t.push(e[i]);return t},concatObj:function(e,t){if("object"==typeof e&&"object"==typeof t)for(var i in t)e[i]=t[i];return e},isEmpty:function(e){var t=!0;if("object"==typeof e)for(var i in e){t=!1;break}else t=e;return t},inArray:function(e,t){return t.filter((function(t){return t==e})).length},loadTag:function(e,t,i){var o=!1;void 0===t||"script"===t?((o=document.createElement("script")).src=e,o.type="text/javascript",o.language="javascript"):((o=document.createElement("link")).href=e,o.rel="stylesheet",o.type="text/css"),document.getElementsByTagName("head")[0].appendChild(o),void 0!==i&&(o.onload=i,o.onreadystatechange=function(){"complete"!==this.readyState&&"loaded"!==this.readyState||o.onload()})}},c={self:this,options:{showWarns:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},showErrors:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},showLogs:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hideMessages:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"}},check:function(e,t,i){var o=this.get(t);return null===o?null:void 0===i?e===o:e==o},get:function(e){return void 0!==this.options[e]?this.options[e].value:(s.warn('Undefined option "'+e+'"'),null)},set:function(e,t){if(void 0===this.options[t])s.warn("Undefined option to set : "+t);else if("function"!=typeof this.options[t].check||this.options[t].check.call(this.self,e))this.options[t].value=e;else{var i=!(void 0===this.options[t].hint||!this.options[t].hint)&&": "+this.options[t].hint;s.warn("Incorrect setting value ("+e+") for option "+t+i)}},iniSetter:function(e,t){for(var i in c.options)c.options[i].setting===t&&void 0!==e[i]&&c.set(e[i],i)}},a={events:{onStart:[]},trigger:function(e,t){if(void 0===this.events[e])s.error("Unknown event "+e);else if(this.events[e].length>0)for(var i in this.events[e])this.events[e][i](t)},iniSetter:function(e){for(var t in this.events)if(this.events.hasOwnProperty(t)&&void 0!==e[t])if("object"==typeof e[t])for(var i in e[t])this.addBind(e[t][i],t);else this.addBind(e[t],t)},addBind:function(e,t){"function"==typeof e?this.events[t].push(e):s.warn('The callback "'+e+'" for '+t+" is not a function")}},l={self:this,states:{start:{_start:!1}},check:function(e){var t=!1;for(var i in this.states){for(var o in this.states[i])o===e&&(this.states[i][o]=!0,t=i);if(t)break}if(t){var r=!0;for(var a in this.states[t])if(!this.states[t][a]){r=!1;break}r&&void 0!==d[t]&&(c.iniSetter(n,t),d[t].call(this.self,n))}else"started"===e?s.error("No callbacks for starting"):s.error("Unknown state of loading: "+e)}},d={start:function(e){a.iniSetter(e),a.trigger("onStart"),l.check("started")}},p={options:"object",states:"object",loaders:"funciton",stages:"object",events:"string"};for(var i in p)if(void 0!==e[i])for(var g in e[i])if({}.hasOwnProperty.call(e[i],g))if(typeof e[i][g]!==p[i])s.error("Illegal "+i+' "'+g+'": '+e[i][g]);else switch(i){case"options":c.options[g]=r.cloneObj(e.options[g]);break;case"states":l.states[g]=r.cloneObj(e.states[g]);break;case"loaders":d[g]=e.loaders[g];break;case"events":a.events[e.events[g]]=[];break;case"stages":"object"!=typeof e.stages[g].states||"function"!=typeof e.stages[g].function?s.error('Illegal stage "'+g+'": '+e[i][g]):(l.states[g]=r.cloneObj(e.stages[g].states),d[g]=e.stages[g].function)}l.check("_start")}function ISDEKWidjet(e){if(!e.path){var t=document.getElementById("ISDEKscript").src;t=t.substring(0,t.indexOf("widjet.js"))+"scripts/",e.path=t}e.servicepath||(e.servicepath=e.path+"service.php"),e.templatepath||(e.templatepath=e.path+"template.php");var i=function(){g.states.check("JSPCSS"),g.states.check("styles")},o=function(){g.states.check("jquery")},n=function(){g.states.check("JSPJS")},s=function(){g.states.check("PVZ")},r=function(){g.states.check("data")},c=function(){g.states.check("lang")},a=function(){g.states.check("ymaps")},l=function(){g.states.check("mapsReady")},d=function(){g.states.check("mapsInited")},p=function(){g.states.check("cityFrom")},g=new ipolWidjetController({label:"ISDEKWidjet",options:{path:{value:e.path,check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (url)"},servicepath:{value:e.servicepath,check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (url)"},templatepath:{value:e.templatepath,check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (url)"},country:{value:"all",check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (countryname)"},lang:{value:"rus",check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (laguage name)"},link:{value:e.link,check:function(e){return ipjq("#"+e).length},setting:"afterJquery",hint:"No element whit this id to put the widjet"},defaultCity:{value:e.defaultCity,check:function(e){return!1!==this.city.check(e)},setting:"dataLoaded",hint:"Default City wasn't founded"},choose:{value:!0,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hidedress:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hidecash:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},hidedelt:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},popup:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},region:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},detailAddress:{value:!1,check:function(e){return"boolean"==typeof e},setting:"start",hint:"Value must be bool (true / false)"},apikey:{value:"ea83aee9-5073-407d-8ebb-a9bc2770cd09",check:function(e){return"string"==typeof e},setting:"start",hint:"Value must be string (apikey)"},goods:{value:!1,check:function(e){if("object"!=typeof e)return!1;if(void 0!==e.width)return!1;for(var t in e)if(!(void 0!==e[t].length&&e[t].length&&void 0!==e[t].width&&e[t].width&&void 0!==e[t].height&&e[t].height&&void 0!==e[t].weight&&e[t].weight))return!1;return!0},setting:"start",hint:"Value must be an array of objects of type {length:(float),width:(float),height(float),weight(float)}"},cityFrom:{value:e.cityFrom,check:function(e){return!1!==this.city.check(e)},setting:"dataLoaded",hint:"City From wasn't founded"}},events:["onChoose","onChooseProfile","onChooseAddress","onReady","onCalculate"],stages:{mainInit:{states:{started:!1},function:function(){this.service.loadTag(this.options.get("path")+"ipjq.js","script",o);var e="rus"==this.options.get("lang")?"ru_RU":"en_GB";this.service.loadTag("https://api-maps.yandex.ru/2.1/?apikey="+this.options.get("apikey")+"&lang="+e,"script",a),this.service.loadTag(this.options.get("path")+"style.css","link",i)}},afterJquery:{states:{jquery:!1},function:function(){this.service.loadTag(this.options.get("path")+"jquery.mCustomScrollbar.concat.min.js","script",n),ipjq.getJSON(g.options.get("servicepath"),{isdek_action:"getPVZ",country:this.options.get("country"),lang:this.options.get("lang")},h.parsePVZFile),ipjq.getJSON(g.options.get("servicepath"),{isdek_action:"getLang",lang:this.options.get("lang")},m.write)}},ymapsBinder1:{states:{ymaps:!1},function:function(){ymaps.ready(l())}},ymapsBinder2:{states:{mapsReady:!1},function:function(){u()}},dataLoaded:{states:{JSPCSS:!1,JSPJS:!1,PVZ:!1,styles:!1,lang:!1},function:function(){r(),g.options.get("cityFrom")?ipjq.getJSON(g.options.get("servicepath"),{isdek_action:"getCity",city:g.options.get("cityFrom")},(function(e){void 0===e.error?f.cityFrom=e.id:g.logger.warn("City from was't found "+e.error),p("onCityFrom")})):p("onCityFrom")}},ready:{states:{data:!1,mapsInited:!1,cityFrom:!1},function:function(){"auto"!=g.options.get("defaultCity")&&h.city.set(g.options.get("defaultCity")),v.readyA=!0,v.html.loadCityList(h.city.collection),g.popupped?g.loadedToAction=!0:g.finalAction()}}},params:e});function u(){void 0===g.incrementer&&(g.incrementer=0),"function"!=typeof ymaps.geocode?g.incrementer++>50?g.logger.error("Unable to load ymaps"):window.setTimeout(u,500):d()}g.popupped=!1,g.loadedToAction=!1,g.finalActionCalled=!1,g.loaderHided=!1,g.finalAction=function(){!0!==g.finalActionCalled&&(g.finalActionCalled=!0,v.controller.loadCity(),this.sdekWidgetEvents(),this.binders.trigger("onReady"))},g.hideLoader=function(){g.loaderHided||(g.loaderHided=!0,ipjq(k.get("PRELOADER")).fadeOut(300),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search, .CDEK-widget__sidebar, .CDEK-widget__logo").removeClass("CDEK-widget__inaccessible"))};var _={blocks:{},getBlock:function(e,t){if(void 0!==_.blocks[e]){if(_tmpBlock=_.blocks[e],"object"==typeof t)for(keyVal in t)_tmpBlock=_tmpBlock.replace(new RegExp("#"+keyVal+"#","g"),t[keyVal]);return _tmpBlock=k.replaceAll(m.replaceAll(_tmpBlock)),_tmpBlock}return""},save:function(e){_.blocks=e,v.html.place()}},h={regions:{collection:{},cityes:{},map:{}},city:{indexOfSome:function(e,t){for(keyI in t)if(t[keyI]==e)return keyI;return!1},collection:{},collectionFull:{},current:!1,get:function(){return this.current},set:function(e,t=!1){return this.checkCity(e)?!(void 0===this.collection[e]&&!t&&!(e=this.indexOfSome(e,this.collection)))&&(this.current=e,e):(g.logger.error("Unknown city: "+e),!1)},checkCity:function(e){return void 0!==this.collection[e]||this.indexOfSome(e,this.collection)>-1},getName:function(e){return!!this.checkCity(e)&&(void 0===this.collection[e]&&(e=this.indexOfSome(e,this.collection)),this.collection[e])},getFullName:function(e){return!!this.checkCity(e)&&(void 0===this.collectionFull[e]&&(e=this.indexOfSome(e,this.collectionFull)),this.collectionFull[e])},getId:function(e){return!!this.checkCity(e)&&(void 0===this.collection[e]&&(e=this.indexOfSome(e,this.collection)),e)}},PVZ:{collection:{},bycoord:{},bycoordCur:0,check:function(e){return h.city.checkCity(e)&&void 0!==this.collection[e]},getCityPVZ:function(e){if(this.check(e))return this.collection[e];g.logger.error("No PVZ in city "+e)},getRegionPVZ:function(e){if(this.check(e)){let t={},i=h.regions.cityes[e],o=[];return o.push(...h.regions.map[i]),81===i&&o.push(...h.regions.map[9]),9===i&&o.push(...h.regions.map[81]),82===i&&o.push(...h.regions.map[26]),26===i&&o.push(...h.regions.map[82]),o.forEach((e,i,o)=>{var n=h.PVZ.collection[e];for(let e in n)t[e]=n[e]}),t}g.logger.error("No PVZ in city "+e)},getCurrent:function(){return g.options.get("region")?this.getRegionPVZ(h.city.current):this.getCityPVZ(h.city.current)}},address:{current:!1,get:function(){return h.address.current},set:function(e){h.address.current=e},fill:function(e){h.address.set(e)}},parsePVZFile:function(e){if(void 0===e.pvz){var t="Unable to load list of PVZ : ";if(void 0===e.pvz){for(var i in e.error)t+=e.error[i]+", ";t=t.substr(0,t.length-2)}else t+="unknown error.";g.logger.error(t)}else{for(var o in void 0!==e.pvz.REGIONS&&(h.regions.collection=e.pvz.REGIONS,h.regions.cityes=e.pvz.CITYREG,h.regions.map=e.pvz.REGIONSMAP),e.pvz.PVZ)h.PVZ.collection[o]=e.pvz.PVZ[o],void 0!==e.pvz.CITY[o]&&void 0===h.city.collection[o]&&(h.city.collection[o]=e.pvz.CITY[o],h.city.collectionFull[o]=e.pvz.CITYFULL[o]);s()}}},f={bad:!1,profiles:{courier:{price:0,term:0,tarif:!1},pickup:{price:0,term:0,tarif:!1}},history:[],defaultGabs:{length:20,width:30,height:40,weight:1},cityFrom:!1,binder:{},calculate:function(e=!1){if(this.cityFrom){let i=this.history.findIndex(e=>e.code===parseInt(h.city.current)&&"courier"===e.type&&e.weight===y.getWeight()),o=this.history.findIndex(e=>e.code===parseInt(h.city.current)&&"pickup"===e.type&&e.weight===y.getWeight());if(-1!==i&&-1!==o){for(var t in this.profiles){let e="pickup"===t?o:i;-1!==e&&(this.profiles[t].price=this.history[e].price,this.profiles[t].term=this.history[e].term,this.profiles[t].tarif=this.history[e].tarif)}g.binders.trigger("onCalculate",{profiles:g.service.cloneObj(f.profiles),city:h.city.current,cityName:h.city.getName(h.city.current)})}else{let t=Date.now();this.binder[parseInt(h.city.current)]={};for(let i in this.profiles)this.profiles[i].price=null,this.profiles[i].term=null,this.profiles[i].tarif=!1,this.request(i,t,e)}}else g.logger.warn("No city from given: calculation is impossible")},request:function(e,t,i=!1){var o={type:e};if(void 0!==y.get()[0]){var n=y.get();for(var s in o.goods=[],n)o.goods.push(n[s])}else o.goods=[this.defaultGabs];o.cityFromId=this.cityFrom,o.cityToId=i?h.city.get():h.city.getId(h.city.current),void 0!==t&&(o.timestamp=t),h.city.current&&ipjq.getJSON(g.options.get("servicepath"),{isdek_action:"calc",shipment:o},f.onCalc)},onCalc:function(e){if(void 0!==e.error){f.bad=!0;var t="",i=!1;for(var o in e.error)if("object"==typeof e.error[o])for(var n in e.error[o])t+=e.error[o][n].text+" ("+e.error[o][n].code+"), ",3===e.error[o][n].code&&(i=!0);else t+=e.error[o]+", ";i?(g.logger.warn("Troubles while calculating: "+t.substring(0,t.length-2)),void 0!==e.type&&(f.profiles[e.type].price=!1,f.profiles[e.type].term=!1,f.profiles[e.type].tarif=!1)):g.logger.error("Error while calculating: "+t.substring(0,t.length-2))}else f.bad=!1,f.profiles[e.type].price=e.result.price,f.profiles[e.type].term=e.result.deliveryPeriodMax===e.result.deliveryPeriodMin?e.result.deliveryPeriodMin:e.result.deliveryPeriodMin+"-"+e.result.deliveryPeriodMax,f.profiles[e.type].tarif=void 0!==e.result.tarif?e.result.tarif:e.result.tariffId,f.history.push({code:parseInt(h.city.current),weight:y.getWeight(),type:e.type,price:e.result.price,term:f.profiles[e.type].term,tarif:f.profiles[e.type].tarif});if(void 0!==e.type&&void 0!==f.binder[parseInt(h.city.current)]){for(var o in f.binder[parseInt(h.city.current)][e.type]=!0,f.profiles)if(void 0===f.binder[parseInt(h.city.current)][o])return!1;g.binders.trigger("onCalculate",{profiles:g.service.cloneObj(f.profiles),city:h.city.current,cityName:h.city.getName(h.city.current)})}}},y={collection:"object"==typeof g.options.get("goods")?g.options.get("goods"):[],add:function(e){"object"!=typeof e||void 0===e.length||void 0===e.width||void 0===e.height||void 0===e.weight?g.logger.error("Illegal item "+e):(this.collection.push({length:e.length,width:e.width,height:e.height,weight:e.weight}),g.calculate())},reset:function(){this.collection=[]},get:function(){return g.service.cloneObj(this.collection)},getWeight:function(){return this.collection.reduce((e,t)=>e+t.weight,0)}},m={collection:{},replaceAll:function(e){for(langKey in this.collection)e=e.replace(new RegExp("#"+langKey+"#","g"),this.collection[langKey]);return e},get:function(e){return void 0!==this.collection[e]?this.collection[e]:(g.logger.warn("No lang string with key "+e),"")},write:function(e){if(ipjq.getJSON(g.options.get("templatepath"),{},_.save),void 0===e.LANG){var t="Unable to load land-file : ";if(void 0!==e.error){for(var i in e.error)t+=e.error[i]+", ";t=t.substr(0,t.length-2)}else t+="unknown error.";g.logger.error(t)}else m.collection=g.service.cloneObj(e.LANG),c()}},k={WID:function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<5;i++)e+=t.charAt(Math.floor(Math.random()*t.length));return e}()+"_",options:{MAP:"SDEK_map",PRELOADER:"preloader"},replaceAll:function(e){for(optKey in this.options)e=e.replace(new RegExp("#"+optKey+"#","g"),this.WID+this.options[optKey].replace("#",""));return e.replace(new RegExp("#WID#","g"),this.WID)},get:function(e){return void 0!==this.options[e]?"#"+this.WID+this.options[e]:"#"+this.WID+e}},v={readyA:!1,html:{get:function(){return _.getBlock("widget",{CITY:g.options.get("defaultCity")})},makeADAPT:function(){if(!g.options.get("link")){var e=ipjq(k.get("cdek_widget_cnt")).outerHeight();e<476||ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box, .mCustomScrollBox").css("max-height","auto"),e<ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__box").outerHeight()+56?ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").css("max-height",e-56+"px"):ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").css("max-height",ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__box").outerHeight()+"px")}},makeFULLSCREEN:function(){this.makeADAPT(),ipjq(window).resize(this.makeADAPT())},place:function(){var e=this.get();g.options.get("link")?ipjq("#"+g.options.get("link")).html(e):g.options.get("popup")?(g.popupped=!0,e=_.getBlock("popup",{WIDGET:e}),ipjq("body").append(e),this.makeFULLSCREEN()):((e=ipjq(e)).css("position","fixed"),e.css("top",0),e.css("left",0),e.css("z-index",1e3),ipjq("body").append(e),this.makeFULLSCREEN()),g.options.get("choose")||ipjq(k.get("cdek_widget_cnt")).addClass("nochoose");var t,i=_.getBlock("sidebar");g.options.get("hidecash")&&((t=[]).push(i.slice(0,132)),t.push(i.slice(1349)),i=t.join(""));g.options.get("hidedress")&&((t=[]).push(i.slice(0,g.options.get("hidecash")?132:1349)),t.push(i.slice(i.indexOf("<hr>"))),i=t.join(""));g.options.get("hidedelt")&&ipjq(k.get("cdek_delivery_types")).hide(),ipjq(k.get("sidebar")).html(i),this.makeADAPT()},loadCityList:function(e){for(var t in _list=ipjq(k.get("city_list")),e)_block=_.getBlock("city",{CITYID:t,CITYNAME:e[t],CITY_DETAILS:void 0!==h.regions.collection[t]?h.regions.collection[t]:"&nbsp;"}),_list.prepend(_block)},updatePrices:function(e){if(ipjq(k.get("cdek_widget_cnt")).find(k.get("cdek_delivery_types")+" div.CDEK-widget__delivery-type__item").remove(),void 0===e||0==e.length)ipjq(k.get("cdek_widget_cnt")).find(k.get("cdek_delivery_type_title span.CDEK_choose")).hide(),ipjq(k.get("cdek_widget_cnt")).find(k.get("cdek_delivery_type_title span.CDEK_no-avail")).show(),ipjq(k.get("cdek_widget_cnt")).find(k.get("cdek_delivery_type_none")).show();else for(var t in ipjq(k.get("cdek_widget_cnt")).find(k.get("cdek_delivery_type_title span.CDEK_choose")).show(),ipjq(k.get("cdek_widget_cnt")).find(k.get("cdek_delivery_type_title span.CDEK_no-avail")).hide(),ipjq(k.get("cdek_widget_cnt")).find(k.get("cdek_delivery_type_none")).hide(),e)switch(t){case"courier":case"pickup":f.bad&&!1===e[t].price||(_tmpBlock=_.getBlock("d_"+t,{SUMM:null===e[t].price?m.get("COUNTING"):e[t].price,RUB:null===e[t].price?"":m.get("RUB"),TIME:null===e[t].term?"":e[t].term,DAY:null===e[t].term?"":m.get("DAY")}),ipjq(k.get("cdek_delivery_types")).append(_tmpBlock))}this.makeADAPT()},hideMap:function(){ipjq(k.get("MAP")).css("display","none"),ipjq(k.get("cdek_widget_cnt")).find("#SDEK_info").css("display","none")}},controller:{getCity:function(){return h.city.get()},loadCity:function(e){ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-details__back").click(),void 0!==e&&1==e||this.calculate(),this.updatePrices(),v.ymaps.init(h.city.current)},selectCity:function(e){"object"==typeof e&&(e=e.data.name),void 0!==e&&e||(e=ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").not(".no-active").first().data("cityid")),h.city.set(e),v.controller.loadCity(),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(h.city.getName(e)),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").removeClass("focus").addClass("no-active").parent("ul").removeClass("open"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]")[0].blur(),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__button").attr("class","CDEK-widget__delivery-type__button"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item").removeClass("active"),setTimeout((function(){ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").removeClass("CDEK-widget__delivery-type_close")}),1e3),v.ui.addressSearch.ifOn()&&v.ui.addressSearch.hide()},putCity:function(e){"object"==typeof e&&(e=e.data.name),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(h.city.getName(e)),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").removeClass("focus").addClass("no-active").parent("ul").removeClass("open")},updatePrices:function(){v.html.updatePrices({courier:f.profiles.courier,pickup:f.profiles.pickup})},calculate:function(e=!1){f.calculate(e)},chooseDeliveryType:function(){if(v.ui.addressSearch.ifOn()&&v.ui.addressSearch.hide(),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").hasClass("open")){var e=ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").find("li.focus");return 0!=e.length?v.controller.selectCity(e.find(".CDEK-widget__search-list__city-name").text()):v.controller.selectCity(),void setTimeout((function(){ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").removeClass("CDEK-widget__delivery-type_close")}),1e3)}ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").removeClass("CDEK-widget__delivery-type_close")},choosePVZ:function(e){var t=ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item:last");t.hasClass("active")||(t.attr("class","CDEK-widget__delivery-type__item").addClass("active"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item:first").attr("class","CDEK-widget__delivery-type__item").removeClass("active"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__button").attr("class","CDEK-widget__delivery-type__button").addClass("CDEK-widget__delivery-type__button_pvz"));var i=h.PVZ.getCurrent();g.binders.trigger("onChoose",{id:e,PVZ:i[e],price:f.profiles.pickup.price,term:f.profiles.pickup.term,tarif:f.profiles.pickup.tarif,city:h.city.current,cityName:h.city.getName(h.city.current)}),g.options.get("link")||this.close()},chooseCOURIER:function(){g.binders.trigger("onChooseProfile",{id:"courier",city:h.city.current,cityName:h.city.getName(h.city.current),price:f.profiles.courier.price,term:f.profiles.courier.term,tarif:f.profiles.courier.tarif}),v.ui.addressSearch.ifOn()||g.options.get("link")?v.ui.addressSearch.ifOn()&&(v.ui.addressSearch.show(),v.ui.addressSearch.fill()):this.close()},open:function(){g.options.get("link")?g.logger.error("This widjet is in non-floating mode - link is set"):v.ui.open()},close:function(){g.options.get("link")?g.logger.error("This widjet is in non-floating mode - link is set"):v.ui.close()}},ui:{currentmark:!1,markChozenPVZ:function(e){v.ymaps.selectMark(e.data.id)},choosePVZ:function(e){v.controller.choosePVZ(e.data.id)},addressSearch:{active:!1,getInput:function(){return ipjq(k.get("cdek_courier_address_place"))},ifOn:function(){return g.options.get("detailAddress")},show:function(){v.ui.addressSearch.active=!0,ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__courier-address__box").removeClass("CDEK-widget__courier-address__box_close")},hide:function(){v.ui.addressSearch.active=!1,v.ui.addressSearch.killBaloon(),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__courier-address__box").addClass("CDEK-widget__courier-address__box_close")},fill:function(){h.city.getName()&&v.ui.addressSearch.getInput().val(h.city.getName(v.controller.getCity())+", "),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__courier-address__button").addClass("allowed")},mapClick:function(e){v.ui.addressSearch.active&&void 0!==e&&(v.ymaps.centerAddr(e.geometry.getCoordinates()),v.ui.addressSearch.getInput().val(e.properties.get("text")),v.ui.addressSearch.makeBaloon(e.geometry.getCoordinates(),e.properties.get("text")))},search:function(){v.ymaps.getSearchAddress(v.ui.addressSearch.getInput().val(),v.ui.addressSearch.found)},found:function(e){v.ui.addressSearch.killBaloon(),v.ymaps.centerAddr(e.coords),v.ui.addressSearch.makeBaloon(e.coords,e.name)},baloon:!1,makeBaloon:function(e,t){v.ui.addressSearch.baloon=v.ymaps.makeBaloon(e,"<div class='CDEK-widget__baloon'>"+t+'<br><button class="CDEK-widget__choose" type="button" data-label="'+m.get("L_CHOOSE")+'">'+m.get("L_CHOOSE")+"</button></div>"),v.ui.addressSearch.baloon&&(v.ui.addressSearch.baloon.balloon.open(),window.setTimeout((function(){ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__baloon .CDEK-widget__choose").on("click",v.ui.addressSearch.clickBaloon)}),500))},killBaloon:function(){v.ui.addressSearch.baloon&&v.ymaps.killBaloon(v.ui.addressSearch.baloon)},clickBaloon:function(){v.ui.addressSearch.killBaloon(),v.ui.addressSearch.choose()},choose:function(){h.address.fill(v.ui.addressSearch.getInput().val()),ipjq.getJSON(g.options.get("servicepath"),{isdek_action:"getCity",address:h.address.get()},(function(e){void 0===e.error?h.city.get()==e.city.id?(v.ui.addressSearch.hide(),g.binders.trigger("onChooseAddress",{id:"courier",city:h.city.current,cityName:h.city.getName(h.city.current),price:f.profiles.courier.price,term:f.profiles.courier.term,tarif:f.profiles.courier.tarif,address:h.address.get()}),g.options.get("link")||this.close()):(h.city.set(e.city.id,!0),ipjq(k.get("cdek_search_input")).val(e.city.city),v.html.updatePrices({courier:{price:null,term:null},pickup:{price:null,term:null}}),alert(m.get("ADDRESS_ANOTHER")),v.controller.calculate(!0),v.controller.chooseDeliveryType()):(alert(m.get("ADDRESS_WRONG")),g.logger.warn("City from was't found "+e.error))}))}},open:function(){ipjq(k.get("CDEK_popup")).show(),g.loadedToAction?g.finalAction():g.popupped=!1,!1!==v.ymaps.map&&v.ymaps.map.container.fitToViewport(),this.active=!0,ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box li").length>=10&&ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar()},close:function(){this.active=!1,ipjq(k.get("CDEK_popup")).hide()}},ymaps:{map:!1,readyToBlink:!1,linker:k.get("MAP").replace("#",""),init:function(e){this.readyToBlink=!1;var t=this;0==e?ymaps.geolocation.get({}).then((function(i){for(var o=i.geoObjects.get(0).properties.get("metaDataProperty").GeocoderMetaData.Address.Components,n=o.length-1;n>=0&&("locality"!=o[n].kind||(e=(e=o[n].name).replace(/город\s|поселок\sгородского\sтипа\s|поселок\s|посёлок\s|деревня\s|село\s/gi,""),h.city.set(e),!1===h.city.current));n--);if(0==h.city.current){o=i.geoObjects.get(0).geometry._coordinates;var s=100;for(var r in h.PVZ.collection)for(var c in h.PVZ.collection[r]){var a=h.PVZ.collection[r][c],l=Math.sqrt(Math.pow(a.cY-o[0],2)+Math.pow(a.cX-o[1],2));s>l&&(a,s=l,e=r)}0!=e?(h.city.set(e),e=h.city.getName(e)):(h.city.set("Москва"),e="Москва")}g.options.set(e,"defaultCity"),v.controller.calculate(),v.controller.updatePrices(),t.loadMap(h.city.current),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(e)})):t.loadMap(h.city.current)},loadMap:function(e){var t=this;e=h.city.getFullName(e);let i={};ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").length&&ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").each((function(){i[ipjq(this).data("mtype")]=!0})),"object"!=typeof h.PVZ.getCurrent()?ymaps.geocode(e,{results:1}).then((function(e){var o=e.geoObjects.get(0).geometry.getCoordinates();t.map?(t.map.setCenter(o),t.map.setZoom(10)):t.makeMap({center:o}),t.placeMarks(i)})):t.placeMarks(i)},makeMap:function(e){if("object"!=typeof e&&(e={}),v.ymaps.map=new ymaps.Map(v.ymaps.linker,g.service.concatObj({zoom:10,controls:[]},e)),this.map.controls.add(new ymaps.control.ZoomControl,{float:"none",position:{left:12,bottom:70}}),v.ymaps.map.events.add("boundschange",g.hideLoader),v.ymaps.map.events.add("actionend",g.hideLoader),g.options.get("detailAddress")){v.ymaps.map.events.add("click",v.ymaps.getClickAddress);new ymaps.SuggestView(k.get("cdek_courier_address_place").substr(1))}},centerAddr:function(e){this.map.setCenter(e),this.map.setZoom(17)},clearMarks:function(){this.map.geoObjects.removeAll;do{var e=this.map;e.geoObjects.each((function(t){e.geoObjects.remove(t)}))}while(e.geoObjects.getBounds())},placeMarks:function(e){let t=h.PVZ.getCurrent();if("object"!=typeof t?ipjq(k.get("sidebar")).hide():ipjq(k.get("sidebar")).show(),ipjq(k.get("panel")).find(k.get("pointlist")).html(""),ipjq(k.get("panel")).find(k.get("pointlist")).html(_.getBlock("panel_list")),_panelContent=ipjq(k.get("pointlist")).find(".CDEK-widget__panel-content"),"object"==typeof t){for(var i in v.ymaps.clusterer=new ymaps.Clusterer({gridSize:50,preset:"islands#ClusterIcons",clusterIconColor:"#0a8c37",hasBalloon:!1,groupByCoordinates:!1,clusterDisableClickZoom:!1,maxZoom:11,zoomMargin:[45],clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1}),geoMarks=[],t){if(void 0!==e){if(void 0!==e.dress&&1!=t[i].Dressing)continue;if(void 0!==e.cash&&1!=t[i].Cash)continue;if(void 0!==e.postamat&&1!=t[i].Postamat)continue}let o=g.options.get("path")+"images/sdekNActive.png",n=g.options.get("path")+"images/sdekActive.png";t[i].placeMark=new ymaps.Placemark([t[i].cY,t[i].cX],{},{iconLayout:"default#image",iconImageHref:o,iconImageSize:[40,43],iconImageOffset:[-10,-31]}),geoMarks.push(t[i].placeMark),t[i].placeMark.link=i,t[i].list_block=ipjq(_.getBlock("point",{P_NAME:t[i].Name,P_ADDR:t[i].Address,P_TIME:t[i].WorkTime.replace(new RegExp(",","g"),"<br/>")})),t[i].placeMark.listItem=t[i].list_block,t[i].placeMark.events.add(["balloonopen","click"],(function(e){if(_prevMark=v.ui.currentmark,v.ui.currentmark=e.get("target"),"object"==typeof _prevMark)try{_prevMark.events.fire("mouseleave")}catch(e){}ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-burger:not(.active)").trigger("click"),v.ui.markChozenPVZ({data:{id:e.get("target").link,link:v.ui}})})),t[i].placeMark.events.add(["mouseenter"],(function(e){ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-content").mCustomScrollbar("scrollTo",e.get("target").listItem),e.get("target").listItem.addClass("CDEK-widget__panel-list__item_active"),e.get("target").options.set({iconImageHref:n})})),t[i].placeMark.events.add(["mouseleave"],(function(e){v.ui.currentmark!=e.get("target")&&(e.get("target").listItem.removeClass("CDEK-widget__panel-list__item_active"),e.get("target").options.set({iconImageHref:o}))})),t[i].list_block.mark=t[i].placeMark,t[i].list_block.on("click",{mark:i},(function(e){t[e.data.mark].placeMark.events.fire("click")})).on("mouseenter",{id:i,ifOn:!0,link:v.ymaps},v.ymaps.blinkPVZ).on("mouseleave",{id:i,ifOn:!1,link:v.ymaps},v.ymaps.blinkPVZ),_panelContent.append(t[i].list_block)}geoMarks.length>0?(v.ymaps.clusterer.add(geoMarks),_bounds=v.ymaps.clusterer.getBounds(),this.map?_bounds[0][0]==_bounds[1][0]?(this.map.setCenter(_bounds[0]),this.map.setZoom(10),v.ymaps.clearMarks(),this.map.geoObjects.add(v.ymaps.clusterer)):this.map.setBounds(v.ymaps.clusterer.getBounds(),{zoomMargin:45,checkZoomRange:!0,duration:500}).then((function(){v.ymaps.clearMarks(),this.map.geoObjects.add(v.ymaps.clusterer),this.map.getZoom()>12&&this.map.setZoom(12)}),(function(){v.ymaps.clearMarks(),this.map.geoObjects.add(v.ymaps.clusterer),this.map.getZoom()>12&&this.map.setZoom(12)}),this):(_bounds[0][0]==_bounds[1][0]?this.makeMap({center:_bounds[0]}):(this.makeMap({bounds:_bounds}),this.map.setBounds(_bounds,{zoomMargin:45,checkZoomRange:!0,duration:500})),v.ymaps.clearMarks(),this.map.geoObjects.add(v.ymaps.clusterer),g.hideLoader())):(v.ymaps.clearMarks(),g.hideLoader())}ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-content").mCustomScrollbar(),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").mCustomScrollbar(),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box li").length>=10&&ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar(),this.readyToBlink=!0},makeUpCenter:function(e){var t=this.map.options.get("projection");return e=this.map.converter.globalToPage(t.toGlobalPixels(e,this.map.getZoom())),ww=ipjq(k.get("panel")).width(),ipjq(k.get("cdek_widget_cnt")).width()-ww>100&&(e[0]=e[0]+ww/2),e=t.fromGlobalPixels(this.map.converter.pageToGlobal(e),this.map.getZoom())},selectMark:function(e){var t=h.PVZ.getCurrent();if(parseInt(h.city.current)!==parseInt(t[e].CityCode)&&(h.city.set(parseInt(t[e].CityCode)),city=h.city.getName(t[e].CityCode),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(city),f.calculate(),v.controller.updatePrices()),this.map.setCenter(v.ymaps.makeUpCenter([t[e].cY,t[e].cX])),_detailPanel=ipjq(k.get("panel")).find(k.get("detail_panel")),_detailPanel.html(""),_photoHTML="",void 0!==t[e].Picture)for(_imgIndex in t[e].Picture)_photoHTML+=_.getBlock("image_c",{D_PHOTO:t[e].Picture[_imgIndex]});_block=ipjq(_.getBlock("panel_details",paramsD={D_NAME:t[e].Name,D_ADDR:t[e].Address,D_TIME:t[e].WorkTime.replace(new RegExp(",","g"),"<br/>"),D_WAY:-1==t[e].AddressComment.search("http")?t[e].AddressComment:"",D_IMGS:_photoHTML})),""==paramsD.D_WAY&&_block.find(".CDEK-widget__way").remove(),""==paramsD.D_IMGS&&_block.find(".sdek_image_block").remove(),_block.find(k.get("choose_button")).on("click",{id:e},(function(e){v.controller.choosePVZ(e.data.id)})),_detailPanel.html(_block),_detailPanel.find(".CDEK-widget__panel-content").mCustomScrollbar(),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list").css("left","-330px"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-details").css("right","0px")},blinkPVZ:function(e){if(e.data.link.readyToBlink){var t=h.PVZ.getCurrent();if(v.ui.currentmark==t[e.data.id].placeMark)return;e.data.ifOn?(e.data.link.clusterer.remove(t[e.data.id].placeMark),e.data.link.map.geoObjects.add(t[e.data.id].placeMark),t[e.data.id].placeMark.options.set({iconImageHref:g.options.get("path")+"images/sdekActive.png"})):(t[e.data.id].placeMark.options.set({iconImageHref:g.options.get("path")+"images/sdekNActive.png"}),e.data.link.map.geoObjects.remove(t[e.data.id].placeMark),e.data.link.clusterer.add(t[e.data.id].placeMark))}},getClickAddress:function(e){ymaps.geocode(e.get("coords"),{kind:"house"}).then((function(e){v.ui.addressSearch.mapClick(e.geoObjects.get(0))}))},getSearchAddress:function(e,t){ymaps.geocode(e,{kind:"house"}).then((function(e){var i=e.geoObjects.get(0),o={name:i.properties.get("name"),descr:i.properties.get("description"),coords:i.geometry.getCoordinates()};return void 0!==t&&t(o),o}))},makeBaloon:function(e,t){var i=new ymaps.Placemark(e,{balloonContent:t},{balloonCloseButton:!1,iconLayout:"default#image"});return v.ymaps.map.geoObjects.add(i),i},killBaloon:function(e){v.ymaps.map.geoObjects.remove(e)}}};return g.binders.add(v.controller.updatePrices,"onCalculate"),g.sdekSetPVZS=function(e){v.ymaps.clearMarks(),void 0===e?v.ymaps.placeMarks():v.ymaps.placeMarks(e)},g.chooseCourier=function(){v.controller.chooseCOURIER()},g.sdekWidgetEvents=function(){ipjq(".CDEK-widget__popup__close-btn").off("click").on("click",(function(){ipjq(this).closest(".CDEK-widget__popup-mask").hide()})),ipjq(k.get("cdek_widget_cnt")).on("click",".CDEK-widget__sidebar-button",{widjet:g},(function(){_this=ipjq(this),_this.toggleClass("active");var e=_this.attr("data-hint"),t=ipjq(k.get("cdek_widget_cnt")).find(e).outerWidth();if(_this.hasClass("CDEK-widget__sidebar-button-point"))if(ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").length){var i={};ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button-point.active").each((function(){i[ipjq(this).data("mtype")]=!0})),g.sdekSetPVZS(i)}else g.sdekSetPVZS();else ipjq(k.get("cdek_widget_cnt")).find(e).css({right:-t,opacity:"0"}),_this.hasClass("CDEK-widget__sidebar-burger")&&(_this.hasClass("close")&&_this.removeClass("close"),_this.toggleClass("open"),_this.hasClass("open")||_this.addClass("close"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel").hasClass("open")?_this.hasClass("active")?(ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeOut(600),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeIn(600),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button_phone").removeClass("active")):(ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeOut(600),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel").removeClass("open")):(ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel").addClass("open"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeIn(600))),_this.hasClass("CDEK-widget__sidebar-button_phone")&&(ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel").hasClass("open")?_this.hasClass("active")?(ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list, .CDEK-widget__panel-details").fadeOut(600),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeIn(600),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-burger").removeClass("active").removeClass("open").addClass("close")):(ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeOut(600),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel").removeClass("open")):(ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel").addClass("open"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-contacts").fadeIn(600)))})).on("click",".CDEK-widget__choose",(function(){ipjq(this).addClass("widget__loading")})),ipjq(k.get("cdek_widget_cnt")).on("mousemove",".CDEK-widget__sidebar-button",(function(){if(!ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel").hasClass("open")){var e=ipjq(this).attr("data-hint");ipjq(k.get("cdek_widget_cnt")).find(e).css({right:"67px",opacity:"1"})}})).on("mouseleave",".CDEK-widget__sidebar-button",(function(){var e=ipjq(this).attr("data-hint"),t=ipjq(k.get("cdek_widget_cnt")).find(e).outerWidth();ipjq(k.get("cdek_widget_cnt")).find(e).css({right:-t,opacity:"0"})})).on("hover",".CDEK-widget__panel-headline",(function(){ipjq(this).outerWidth()<=ipjq(this).find("span").outerWidth()&&ipjq(this).addClass("hover-long")}),(function(){ipjq(this).hasClass("hover-long")&&ipjq(this).removeClass("hover-long")})),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__sidebar-button").each((function(e,t){var i=ipjq(t).attr("data-hint"),o=(ipjq(t).outerHeight()+-ipjq(k.get("cdek_widget_cnt")).find(i).outerHeight())/2+62*e,n=ipjq(k.get("cdek_widget_cnt")).find(i).outerWidth();ipjq(k.get("cdek_widget_cnt")).find(i).css({right:-n,top:o,opacity:"0"})})),ipjq(k.get("cdek_widget_cnt")).on("click",".CDEK-widget__panel-details__back",(function(){ipjq(this).parents(".CDEK-widget__panel-details").css("right","-330px"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__panel-list").css("left","0px")})).on("click",".CDEK-widget__panel-details__block-img",(function(){var e=ipjq(this).find("img").attr("src"),t=ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__photo");t.find("img").attr("src",e),t.addClass("active")})).on("click",".CDEK-widget__photo",(function(e){ipjq(e.target).is("img")||ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__photo").removeClass("active")})).on("focusin",".CDEK-widget__search-box input[type=text]",(function(){ipjq(this).val(""),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").hasClass("CDEK-widget__delivery-type_close")?ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").addClass("open").find("li").removeClass("no-active"):(ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type").addClass("CDEK-widget__delivery-type_close"),setTimeout((function(){ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul").addClass("open").find("li").removeClass("no-active")}),1e3))})).on("click",".CDEK-widget__search-list ul li",(function(){v.controller.selectCity(ipjq(this).data("cityid"))})).on("keydown",".CDEK-widget__search-box input[type=text]",(function(e){var t=ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li:not(.no-active)"),i=t.filter(".focus");40===e.keyCode&&(0==i.length?(t.first().addClass("focus"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",t.first(),{scrollInertia:300})):(i.removeClass("focus"),0!=i.nextAll().filter(":not(.no-active)").eq(0).length?(i.nextAll().filter(":not(.no-active)").eq(0).addClass("focus"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",i.next(t),{scrollInertia:300})):(t.first().addClass("focus"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",t.first(),{scrollInertia:300})))),38===e.keyCode&&(0==i.length?(t.last().addClass("focus"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",t.last(),{scrollInertia:300})):(i.removeClass("focus"),0!=i.prevAll().filter(":not(.no-active)").eq(0).length?(i.prevAll().filter(":not(.no-active)").eq(0).addClass("focus"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",i.prev(t),{scrollInertia:300})):(t.last().addClass("focus"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list__box").mCustomScrollbar("scrollTo",t.last(),{scrollInertia:300}))))})).on("keyup",".CDEK-widget__search-box input[type=text]",(function(e){try{var t=new RegExp("^("+ipjq(this).val()+")+.*","i")}catch(e){t=""}var i=ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li");if(13!==e.keyCode)""!=t?($matches=i.filter((function(){return t.test(ipjq(this).find(".CDEK-widget__search-list__city-name").text().replace(/[^\wа-яё\s-]+/gi,""))})),i.not($matches).addClass("no-active").removeClass("focus"),0==$matches.length?i.parent("ul").removeClass("open"):i.parent("ul").hasClass("open")||i.parent("ul").addClass("open"),$matches.each((function(e,t){ipjq(t).hasClass("no-active")&&ipjq(t).removeClass("no-active")}))):i.removeClass("no-active");else{var o=i.not(".no-active").filter(".focus");0==o.length?v.controller.selectCity():(v.controller.selectCity(o.find(".CDEK-widget__search-list__city-name").text()),o.removeClass("focus"))}})).on("click",(function(e){0==ipjq(e.target).closest(".CDEK-widget__search").length&&0!=ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-list ul li").not(".no-active").length&&v.controller.putCity(v.controller.getCity())})).on("click",".CDEK-widget__delivery-type__item",{widjet:g},(function(e){var t=ipjq(this).attr("data-delivery-type");ipjq(this).hasClass("active")||(ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__item.active").removeClass("active"),ipjq(this).addClass("active"),ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__delivery-type__button").attr("class","CDEK-widget__delivery-type__button").addClass("CDEK-widget__delivery-type__button_"+t)),"courier"==t&&e.data.widjet.chooseCourier(),ipjq(this).parents(".CDEK-widget__delivery-type").addClass("CDEK-widget__delivery-type_close")})).on("click",".CDEK-widget__delivery-type__button",(function(){v.controller.chooseDeliveryType()})).on("click",".CDEK-widget__courier-address__button",(function(){v.ui.addressSearch.search()}))},g.city={get:function(){return h.city.current},set:function(e){let t=h.city.set(e);!1!==t&&ipjq(k.get("cdek_widget_cnt")).find(".CDEK-widget__search-box input[type=text]").val(h.city.getName(t)),v.controller.loadCity()},check:function(e){return h.city.getId(e)}},g.PVZ={get:function(e){return h.PVZ.getCityPVZ(e)},check:function(e){return h.PVZ.check(e)}},g.cargo={add:function(e){y.add(e)},reset:function(){y.reset()},get:function(){return y.get()}},g.calculate=function(){return f.calculate(),f.profiles},g.options.get("link")||(g.open=function(){v.controller.open()},g.close=function(){v.controller.close()}),g}
